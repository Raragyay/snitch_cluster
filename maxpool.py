import numpy as np

# maxpool_attributes attr3 = {
#   .n_dim = 3,
#   .input_shape = {1, 1, 10, 8, 5},
#   .output_shape = {0},
#   .auto_pad = NOTSET,
#   .ceil_mode = 0,
#   .dilations = {1, 1, 1},
#   .kernel_shape = {5, 4, 2},
#   .pads = {0, 0, 0, 0, 0, 0},
#   .storage_order = 0,
#   .strides = {1, 1, 1}
# };

x = (np.array([0.5795346500396908,	-1.2782345590126178,	0.7129850612719937,	0.8351267855766752,	1.8408481575086715,	-0.5592605618803663,	-0.6131675331512736,	-1.5330654552321985,	-0.8406102618359056,	0.5484565217119107,	-0.4939692736837665,	2.626308207175177,	1.83331026267876,	2.19922253362546,	-0.28796126895498547,	-0.24939947189824624,	1.37042507253141,	-2.083883265911992,	-0.16303769452716377,	0.1564872328878123,	0.5464514551062117,	-1.1535934052535668,	-0.10958989049853177,	-1.52069148683102,	1.3146261643078498,	-0.5103602280069186,	0.7230601818345361,	-0.5639603595848214,	-0.476572973163294,	-0.43327795472091074,	-0.9643842402471913,	-1.3527976302239002,	-1.6570290660133018,	-0.659324041628754,	-0.5905132774062675,	0.10107794948377379,	0.9036962776218405,	-2.8520332619700848,	-0.8127770978938846,	-0.2719243585180919,	0.28755341332221374,	-0.5830078924660606,	0.39133797904183293,	0.04191141835785834,	-1.1632624930601416,	1.0784493661404453,	1.1880859362918894,	-0.4972374032923037,	0.24264217393007192,	0.06631986402704407,	0.8248981300268698,	0.8578108590355236,	-0.3048736812412164,	-0.29340768565788794,	1.203013679717089,	-0.21233358567474395,	-1.012027294662948,	0.6706758830917166,	0.6817579712288174,	-0.25529559724859335,	1.0338736694936117,	-0.8082818599422349,	-1.5826442004267116,	1.471119284677931,	1.7598084493665322,	1.0104752106584565,	-0.6772461284583484,	-0.015495131524845081,	-0.36996434864651995,	-0.20633703043517052,	0.9349436045844446,	1.5685386005543824,	0.018231844420098682,	-1.6348939726985652,	-0.4047545217639019,	-0.08641027938629302,	0.38577658641259177,	-0.4031404266151937,	-0.03088176641940203,	-1.0344287396665524,	0.1907559262050842,	0.08208331965833816,	0.6645389173591718,	-0.5067792480004788,	0.5171794290951623,	-0.600341108995412,	-1.5480103556762894,	-0.15849001619826586,	0.4371703139203049,	-2.2514455054128275,	-1.0255710735021715,	0.09243395191246542,	0.025279168022819626,	1.4996046947968387,	-0.004721994123475729,	0.8284657470603107,	-0.05249039449642621,	0.7603239393689171,	1.5115296903743751,	1.328078527096851,	2.7499029332137352,	2.0444994218325823,	-1.6719410198506903,	-0.40905736839208695,	1.1257822734774534,	-0.30754088355494535,	-0.24652468675451586,	0.17050265709326612,	0.35449449570924224,	0.7244603096780263,	0.8638549814174924,	-0.9112288594302798,	-1.4783171481875856,	0.8768656872907535,	-0.5462467752703077,	0.08938012996014413,	0.27839705636108075,	0.14752521707650545,	-0.43273400207879864,	-2.4049787649328054,	1.034953190085423,	0.3260491068345115,	-1.6903555889683028,	-0.21442333221573912,	0.489369469686188,	1.4333156056754133,	-0.28683041861022585,	0.2920229017876009,	1.106798415370779,	-0.8798714008846729,	-1.10211149738662,	-1.2240843425615457,	0.2956608385024862,	-0.4865867303253786,	0.320054826754206,	-0.8517592134086077,	0.7816438102906836,	0.9835196653119083,	0.632083779480333,	-0.13743874817888485,	-0.8441768828867646,	0.18901804817478193,	1.1527638149703425,	-0.5737415460605092,	-0.7885095087062203,	0.3301606181486821,	0.3560112146567841,	1.45665445132406,	0.21881472054945522,	-0.5780264203027413,	1.7258581904638826,	1.2766374092726767,	0.6107395066375455,	-2.1741261547873005,	0.27632857869446587,	-0.5782891504481107,	-0.7467566315037012,	0.04519293087185373,	-0.7389105775903956,	1.751735049587628,	0.18311887342518732,	0.09466204143421897,	-2.0419329652519598,	-1.653233120337862,	-0.7120020458004005,	-0.8585512100496033,	-0.2792509318414314,	1.1260175100120082,	0.8382874912203289,	-1.4187091938592886,	0.19207335601578118,	-1.2549459655003812,	0.3455986433316224,	-0.6347162708055833,	0.06600035858262378,	-1.464069545337494,	-0.5761479636656854,	0.6103255003043495,	0.5264447617972285,	-0.6501018468489129,	0.3062203076469043,	-0.09194677458718745,	-2.2244471766864335,	2.059835110654219,	-1.283479526856543,	0.5656822514875587,	0.948160933481725,	0.31389458752780797,	0.01667371100258851,	-0.17242368167507477,	-1.7872105658519477,	-1.0677682455201754,	-0.5556854511609958,	0.24994967444656443,	0.4040571565262094,	1.01524194643683,	0.4362239290200242,	0.37836972349443654,	-0.8724692786784237,	-1.8244363070788179,	-0.3612873987679688,	-1.2939583119264615,	-0.06530046253424181,	-0.3404140020594896,	-2.2404640668858575,	0.49562468679868177,	1.7218419270677492,	0.12714707160601346,	0.3983554821537925,	-0.3034134746407296,	-0.3605218383813717,	-0.7081369384579,	-0.3353018722915574,	-0.5249529104732592,	0.40513741678671733,	0.08052826816060776,	0.1594747568192323,	0.1299864751530147,	-0.28942666880581996,	0.814950350509426,	0.026991054917171322,	-0.7092563622871317,	0.7609389872525532,	-0.7226634421506662,	-1.3444210748403516,	-0.10013389568442885,	-0.15895904289018004,	-0.22309651336529787,	-0.47978228544994034,	-2.014104714326004,	0.9660943151700144,	0.954790365906146,	-0.3675781721079322,	0.7320987635642625,	-1.217250070605816,	-0.2512204531375182,	0.6791766155281823,	1.0602710363397239,	0.2892329848906806,	0.6921189220237485,	-0.8389327163333327,	1.2229589063910966,	0.4493237622235722,	0.02778804873445767,	-1.3731244512714358,	-1.1602887500336883,	0.03979867596984191,	1.7984907529452114,	-0.35655807779586046,	-0.17246033222038062,	-0.4968931196748636,	0.6534794813695407,	-0.26891477047485884,	-1.092500426344572,	-1.1706717802513518,	-0.3224091991279599,	1.3659849090214804,	1.8535165307809394,	-0.9411843410872706,	-1.154022944023709,	0.8446693503373867,	-0.222069477314518,	0.5497226848353645,	-1.592104424391043,	0.5669842029709273,	-0.5872009684668402,	-1.657801440209905,	-0.2766841430984105,	-0.6736184478485914,	0.7234804753093141,	1.1162652217260276,	0.09471327146432652,	-0.4088541966401061,	-0.1426977455589933,	-0.15071437366010035,	-0.7037116679170549,	-0.07545245135420557,	-0.4762720028458215,	-0.755360534432581,	0.33581945269525576,	0.8293528950631454,	0.3275191893814449,	-0.13326708006611973,	-1.5527746109773184,	-0.42136253607192825,	0.1905664548345142,	-0.28079581612874926,	0.8657304416053548,	1.2357046703155394,	1.3697477231588935,	0.711755079901643,	-0.8220152793349371,	-1.178671369435214,	0.2305577709471464,	0.22349634744051144,	0.016598357046133275,	-0.07891149531210018,	0.09284177106919952,	0.3043007094562426,	-1.3497263657523335,	-0.6518386902789853,	0.6481515977750815,	1.404377314044884,	-0.5851079760033124,	0.45566054384806465,	-0.04143888402309481,	0.027855778469949147,	-0.9685338050875864,	1.5552756994117358,	-0.35221375378073094,	0.4600730756184166,	1.7176514154804876,	0.42394859475706337,	-0.6518564816278987,	-0.19007736413574408,	-1.7447779114655382,	-0.6059795531371921,	0.09962707458135885,	-1.205657994891761,	-1.602921854306322,	-0.661695425424718,	-2.15776284709025,	-0.33756392189220225,	-0.5965744611443189,	-0.1910292129685941,	-1.0775520390720965,	-0.47655345828791984,	0.2886042773245967,	0.702253946354999,	-0.01490223246934205,	0.03857430542004584,	-0.837601142557255,	1.2952165240252855,	0.2807606650035408,	1.5571993051420379,	-0.9108854724981812,	-0.5133835139797583,	0.5173415394719093,	-1.8318103809311075,	-0.2282562840002306,	-2.264284154128949,	-0.9483471115297263,	-1.9233779490026053,	-1.3669385216779364,	0.6146624747247398,	-0.7658865131765821,	-0.35756652506584796,	0.2351894597322765,	-0.5925202631953052,	-0.3165858000525251,	-0.5807826313569625,	-0.44813201164227723,	0.775197717056725,	-0.37804137463759646,	0.3419462954201844,	0.49809842602699506,	0.27621602919933064,	0.11810440024586945,	0.9815165514822684,	-0.4057294652078836,	-0.49799933788825024,	1.4757391337481958,	-0.7161615521841751,	-0.7175785150770978,	1.9204518572159581,	1.943142478848257,	1.1626089498294054,	0.03344295368642233,	-0.537733833056473,	0.08708836771290972,	1.8853954319827668,	0.49360532991440725,	-0.020841545227892406,	-0.6273282542536243,	-1.4833677084692454,	-1.2156795913703002,	-0.1420466101530611,	0.06324150469405784,	-0.4216942046265947,	1.1295186749275739,	0.3049908601045811,	-0.8232503217763881,	-0.18005029959510138,	0.2573173715798343,	-2.4260049542755593,	-0.33563596533976636,	0.8191969877971689,	0.8493445537584626,	0.7989169528186338,	-1.6315705443712336,	-0.9927423758297216,	-0.6182780809735906,	-0.9538895440563431,	0.924631472350977,	-0.49960592466513015,	-1.4383472204052832,	1.2322218650967824,	-1.2434929109357284,	0.1310368110818202,	0.28785073391659877])
).reshape((1, 1, 10, 8, 5))

output_spatial_shape = (6, 5, 4)
kernel_shape = (5, 4, 2)
strides = (1, 1, 1)
dilations = (1, 1, 1)
new_pads = [[0, 0], [0, 0], [0, 0]]
storage_order = 0

global_pooling = False
y_dims = x.shape[:2] + tuple(output_spatial_shape)
y = np.zeros(y_dims, dtype=x.dtype)
# indices = np.full(y_dims, dtype=np.int64, fill_value=-1)
x_dims = x.shape
channels = x_dims[1]
height = x_dims[2]
width = x_dims[3] if len(kernel_shape) > 1 else 1
depth = x_dims[4] if len(kernel_shape) > 2 else 1
pooled_height = y_dims[2]
pooled_width = y_dims[3] if len(kernel_shape) > 1 else 1
pooled_depth = y_dims[4] if len(kernel_shape) > 2 else 1
total_channels = x_dims[0] * channels
stride_h = 1 if global_pooling else strides[0]
stride_w = 1 if global_pooling else strides[1]
stride_d = 1 if global_pooling else strides[2]

x_step = height * width * depth
y_step = pooled_height * pooled_width * pooled_depth
dilation_h = dilations[0]
dilation_w = dilations[1]
dilation_d = dilations[2]

X_data = (np.array([0.5795346500396908,	-1.2782345590126178,	0.7129850612719937,	0.8351267855766752,	1.8408481575086715,	-0.5592605618803663,	-0.6131675331512736,	-1.5330654552321985,	-0.8406102618359056,	0.5484565217119107,	-0.4939692736837665,	2.626308207175177,	1.83331026267876,	2.19922253362546,	-0.28796126895498547,	-0.24939947189824624,	1.37042507253141,	-2.083883265911992,	-0.16303769452716377,	0.1564872328878123,	0.5464514551062117,	-1.1535934052535668,	-0.10958989049853177,	-1.52069148683102,	1.3146261643078498,	-0.5103602280069186,	0.7230601818345361,	-0.5639603595848214,	-0.476572973163294,	-0.43327795472091074,	-0.9643842402471913,	-1.3527976302239002,	-1.6570290660133018,	-0.659324041628754,	-0.5905132774062675,	0.10107794948377379,	0.9036962776218405,	-2.8520332619700848,	-0.8127770978938846,	-0.2719243585180919,	0.28755341332221374,	-0.5830078924660606,	0.39133797904183293,	0.04191141835785834,	-1.1632624930601416,	1.0784493661404453,	1.1880859362918894,	-0.4972374032923037,	0.24264217393007192,	0.06631986402704407,	0.8248981300268698,	0.8578108590355236,	-0.3048736812412164,	-0.29340768565788794,	1.203013679717089,	-0.21233358567474395,	-1.012027294662948,	0.6706758830917166,	0.6817579712288174,	-0.25529559724859335,	1.0338736694936117,	-0.8082818599422349,	-1.5826442004267116,	1.471119284677931,	1.7598084493665322,	1.0104752106584565,	-0.6772461284583484,	-0.015495131524845081,	-0.36996434864651995,	-0.20633703043517052,	0.9349436045844446,	1.5685386005543824,	0.018231844420098682,	-1.6348939726985652,	-0.4047545217639019,	-0.08641027938629302,	0.38577658641259177,	-0.4031404266151937,	-0.03088176641940203,	-1.0344287396665524,	0.1907559262050842,	0.08208331965833816,	0.6645389173591718,	-0.5067792480004788,	0.5171794290951623,	-0.600341108995412,	-1.5480103556762894,	-0.15849001619826586,	0.4371703139203049,	-2.2514455054128275,	-1.0255710735021715,	0.09243395191246542,	0.025279168022819626,	1.4996046947968387,	-0.004721994123475729,	0.8284657470603107,	-0.05249039449642621,	0.7603239393689171,	1.5115296903743751,	1.328078527096851,	2.7499029332137352,	2.0444994218325823,	-1.6719410198506903,	-0.40905736839208695,	1.1257822734774534,	-0.30754088355494535,	-0.24652468675451586,	0.17050265709326612,	0.35449449570924224,	0.7244603096780263,	0.8638549814174924,	-0.9112288594302798,	-1.4783171481875856,	0.8768656872907535,	-0.5462467752703077,	0.08938012996014413,	0.27839705636108075,	0.14752521707650545,	-0.43273400207879864,	-2.4049787649328054,	1.034953190085423,	0.3260491068345115,	-1.6903555889683028,	-0.21442333221573912,	0.489369469686188,	1.4333156056754133,	-0.28683041861022585,	0.2920229017876009,	1.106798415370779,	-0.8798714008846729,	-1.10211149738662,	-1.2240843425615457,	0.2956608385024862,	-0.4865867303253786,	0.320054826754206,	-0.8517592134086077,	0.7816438102906836,	0.9835196653119083,	0.632083779480333,	-0.13743874817888485,	-0.8441768828867646,	0.18901804817478193,	1.1527638149703425,	-0.5737415460605092,	-0.7885095087062203,	0.3301606181486821,	0.3560112146567841,	1.45665445132406,	0.21881472054945522,	-0.5780264203027413,	1.7258581904638826,	1.2766374092726767,	0.6107395066375455,	-2.1741261547873005,	0.27632857869446587,	-0.5782891504481107,	-0.7467566315037012,	0.04519293087185373,	-0.7389105775903956,	1.751735049587628,	0.18311887342518732,	0.09466204143421897,	-2.0419329652519598,	-1.653233120337862,	-0.7120020458004005,	-0.8585512100496033,	-0.2792509318414314,	1.1260175100120082,	0.8382874912203289,	-1.4187091938592886,	0.19207335601578118,	-1.2549459655003812,	0.3455986433316224,	-0.6347162708055833,	0.06600035858262378,	-1.464069545337494,	-0.5761479636656854,	0.6103255003043495,	0.5264447617972285,	-0.6501018468489129,	0.3062203076469043,	-0.09194677458718745,	-2.2244471766864335,	2.059835110654219,	-1.283479526856543,	0.5656822514875587,	0.948160933481725,	0.31389458752780797,	0.01667371100258851,	-0.17242368167507477,	-1.7872105658519477,	-1.0677682455201754,	-0.5556854511609958,	0.24994967444656443,	0.4040571565262094,	1.01524194643683,	0.4362239290200242,	0.37836972349443654,	-0.8724692786784237,	-1.8244363070788179,	-0.3612873987679688,	-1.2939583119264615,	-0.06530046253424181,	-0.3404140020594896,	-2.2404640668858575,	0.49562468679868177,	1.7218419270677492,	0.12714707160601346,	0.3983554821537925,	-0.3034134746407296,	-0.3605218383813717,	-0.7081369384579,	-0.3353018722915574,	-0.5249529104732592,	0.40513741678671733,	0.08052826816060776,	0.1594747568192323,	0.1299864751530147,	-0.28942666880581996,	0.814950350509426,	0.026991054917171322,	-0.7092563622871317,	0.7609389872525532,	-0.7226634421506662,	-1.3444210748403516,	-0.10013389568442885,	-0.15895904289018004,	-0.22309651336529787,	-0.47978228544994034,	-2.014104714326004,	0.9660943151700144,	0.954790365906146,	-0.3675781721079322,	0.7320987635642625,	-1.217250070605816,	-0.2512204531375182,	0.6791766155281823,	1.0602710363397239,	0.2892329848906806,	0.6921189220237485,	-0.8389327163333327,	1.2229589063910966,	0.4493237622235722,	0.02778804873445767,	-1.3731244512714358,	-1.1602887500336883,	0.03979867596984191,	1.7984907529452114,	-0.35655807779586046,	-0.17246033222038062,	-0.4968931196748636,	0.6534794813695407,	-0.26891477047485884,	-1.092500426344572,	-1.1706717802513518,	-0.3224091991279599,	1.3659849090214804,	1.8535165307809394,	-0.9411843410872706,	-1.154022944023709,	0.8446693503373867,	-0.222069477314518,	0.5497226848353645,	-1.592104424391043,	0.5669842029709273,	-0.5872009684668402,	-1.657801440209905,	-0.2766841430984105,	-0.6736184478485914,	0.7234804753093141,	1.1162652217260276,	0.09471327146432652,	-0.4088541966401061,	-0.1426977455589933,	-0.15071437366010035,	-0.7037116679170549,	-0.07545245135420557,	-0.4762720028458215,	-0.755360534432581,	0.33581945269525576,	0.8293528950631454,	0.3275191893814449,	-0.13326708006611973,	-1.5527746109773184,	-0.42136253607192825,	0.1905664548345142,	-0.28079581612874926,	0.8657304416053548,	1.2357046703155394,	1.3697477231588935,	0.711755079901643,	-0.8220152793349371,	-1.178671369435214,	0.2305577709471464,	0.22349634744051144,	0.016598357046133275,	-0.07891149531210018,	0.09284177106919952,	0.3043007094562426,	-1.3497263657523335,	-0.6518386902789853,	0.6481515977750815,	1.404377314044884,	-0.5851079760033124,	0.45566054384806465,	-0.04143888402309481,	0.027855778469949147,	-0.9685338050875864,	1.5552756994117358,	-0.35221375378073094,	0.4600730756184166,	1.7176514154804876,	0.42394859475706337,	-0.6518564816278987,	-0.19007736413574408,	-1.7447779114655382,	-0.6059795531371921,	0.09962707458135885,	-1.205657994891761,	-1.602921854306322,	-0.661695425424718,	-2.15776284709025,	-0.33756392189220225,	-0.5965744611443189,	-0.1910292129685941,	-1.0775520390720965,	-0.47655345828791984,	0.2886042773245967,	0.702253946354999,	-0.01490223246934205,	0.03857430542004584,	-0.837601142557255,	1.2952165240252855,	0.2807606650035408,	1.5571993051420379,	-0.9108854724981812,	-0.5133835139797583,	0.5173415394719093,	-1.8318103809311075,	-0.2282562840002306,	-2.264284154128949,	-0.9483471115297263,	-1.9233779490026053,	-1.3669385216779364,	0.6146624747247398,	-0.7658865131765821,	-0.35756652506584796,	0.2351894597322765,	-0.5925202631953052,	-0.3165858000525251,	-0.5807826313569625,	-0.44813201164227723,	0.775197717056725,	-0.37804137463759646,	0.3419462954201844,	0.49809842602699506,	0.27621602919933064,	0.11810440024586945,	0.9815165514822684,	-0.4057294652078836,	-0.49799933788825024,	1.4757391337481958,	-0.7161615521841751,	-0.7175785150770978,	1.9204518572159581,	1.943142478848257,	1.1626089498294054,	0.03344295368642233,	-0.537733833056473,	0.08708836771290972,	1.8853954319827668,	0.49360532991440725,	-0.020841545227892406,	-0.6273282542536243,	-1.4833677084692454,	-1.2156795913703002,	-0.1420466101530611,	0.06324150469405784,	-0.4216942046265947,	1.1295186749275739,	0.3049908601045811,	-0.8232503217763881,	-0.18005029959510138,	0.2573173715798343,	-2.4260049542755593,	-0.33563596533976636,	0.8191969877971689,	0.8493445537584626,	0.7989169528186338,	-1.6315705443712336,	-0.9927423758297216,	-0.6182780809735906,	-0.9538895440563431,	0.924631472350977,	-0.49960592466513015,	-1.4383472204052832,	1.2322218650967824,	-1.2434929109357284,	0.1310368110818202,	0.28785073391659877])
)
Y_data = np.zeros((120,), dtype=x.dtype)

def iteration(c):
  x_d = c * x_step
  y_d = c * y_step
  i_d = c * y_step

  for ph in range(pooled_height):
    hstart = ph * stride_h - new_pads[0][0]
    hend = hstart + kernel_shape[0] * dilation_h
    for pw in range(pooled_width):
      wstart = pw * stride_w - new_pads[1][0]
      wend = wstart + kernel_shape[1] * dilation_w
      for pd in range(pooled_depth):
        dstart = pd * stride_d - new_pads[2][0]
        dend = dstart + kernel_shape[2] * dilation_d
        pool_index = (
            ph * pooled_width * pooled_depth + pw * pooled_depth + pd
        )
        Yh = None
        h_index = -1
        w_index = -1
        d_index = -1

        if pool_index == 13:
          print(f"{hstart} {hend}, {wstart} {wend}, {dstart} {dend}")

        for h in range(hstart, hend, dilation_h):
          if h < 0 or h >= height:
            continue
          for w in range(wstart, wend, dilation_w):
            if w < 0 or w >= width:
              continue
            for d in range(dstart, dend, dilation_d):
              if d < 0 or d >= depth:
                continue
              input_index = h * width * depth + w * depth + d
              if Yh is None or X_data[x_d + input_index] > Yh:
                Yh = X_data[x_d + input_index]
                h_index = h
                w_index = w
                d_index = d

        Y_data[y_d + pool_index] = Yh
        # print(
        #       (
        #           c * x_step
        #           + h_index * width * depth
        #           + w_index * depth
        #           + d_index
        #       )
        #       if storage_order == 0
        #       else (
        #           c * x_step
        #           + h_index
        #           + w_index * height
        #           + d_index * height * width
        #       )
        #   )

for c in range(total_channels):
  iteration(c)

print(Y_data)

print(X_data[183])